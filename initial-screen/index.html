<!DOCTYPE html>
<html>

<head>
    <title>Locaai - O Seu Site de Eventos</title>
    <link rel="stylesheet" type="text/css" href="../top-bar/css/topBarStyle.css">
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link rel="stylesheet" type="text/css" href="../properties-filters-screen/style/styles.css">
    <link rel="icon" type="icon/png" href="img/icon.png">
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
    <script src="../top-bar/topBarFunctions.js" defer></script>
    <script src="../properties-filters-screen/script/script.js"></script>
</head>

<body>
    <!-- Start of the search bar -->
    <div class="searchBar">
        <img id="logo" class="logoTop" src="../top-bar/img/logoLado.png">
        <div class="searchBar2">
            <input type="text" placeholder="Vai pra onde?" class="searchInput">
            <input type="number" id="justNumberInput" placeholder="Quantos dias?" class="searchInput">
            <div class="searchInputWrapper">
                <input type="number" id="justNumberInput" placeholder="Com quem?" class="searchInputWithButton">
                <button type='submit' class="buttonSearch"></button>
                <button type='submit' class="buttonFilters" id="toggleButton"></button>
            </div>
            <div class="announcementButtonAlign">
                <button class="announcementButton">ANUNCIE!</button>
            </div>
        </div>

        <a href="../profile-screen/index.html">
            <div class="picAndLabels">
                <div class="textLocatorInfo">
                    <label class="textName">Eduardo França</label>
                    <label class="locatorLevel">Locador Ouro</label>
                </div>
                <img class="profilePicLogo" src="../top-bar/img/profilePicTest.png">
            </div>
        </a>
    </div>

    <div id="categoriesBar" class="categoriesBar">
        <div class="categoriesAlignTopBar2">
            <a class="categoriesAlignTopBar" onclick="filterProperties('Auditorio')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/auditoriums.png">
                <label>Auditórios</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Praia')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/beaches.png">
                <label>Praias</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Bistro')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/bistros.png">
                <label>Bistrôs</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Castelo')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/castles-and-palaces.png">
                <label>Castelos</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Capela')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/chapels.png">
                <label>Capelas</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Clube')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/clubs-and-associations.png">
                <label>Clubes</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Co-working')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/co-working.png">
                <label>Co-working</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Convencao')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/convention-centers.png">
                <label>Convenções</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Cobertura')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/coverages.png">
                <label>Coberturas</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Lago')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/dams-and-lakes.png">
                <label>Rios e Lagos</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Fazenda')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/farms and-ranches.png">
                <label>Fazendas</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Chacara')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/farms.png">
                <label>Chácaras</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Jardim')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/gardens.png">
                <label>Jardins</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Hotel')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/hotels-and-inns.png">
                <label>Hotéis</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Ilha')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/islands.png">
                <label>Ilhas</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Lounge')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/lounges.png">
                <label>Lounges</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Mansao')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/mansions.png">
                <label>Mansões</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Salao')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/party-halls.png">
                <label>Salões de Festa</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Resort')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/resorts.png">
                <label>Resorts</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Barracao')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/sheds.png">
                <label>Barracões</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Estadio')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/stadiums-and-arenas.png">
                <label>Estádios</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('ParqueTematico')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/theme-parks.png">
                <label>Parques Temáticos</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('ParqueAquatico')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/water-parks.png">
                <label>Parques Aquáticos</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="filterProperties('Embarcacao')">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/yachts-and-vessels.png">
                <label>Embarcações</label>
            </a>
            <a class="categoriesAlignTopBar" onclick="clearFilters()">
                <img class="categoriesBarImage" src="../(IMGs) CATEGORIES ICONS/clear-filters.png">
                <label>Limpar Filtros</label>
            </a>
        </div>
    </div>
    <!-- End of the search bar -->
    <div class="placesLine" id="placesContainer"></div>

    <button class="buttonNewFilter" id="newFilterButton">
        <img src="../properties-filters-screen/img/filter.png" alt="Filter">
    </button>
    </div>
    <div id="newFiltersSidebar" class="newFiltersSidebar">
        <div class="filterGroup">
            <h2>Local:</h2>
            <div class="filterOptions">
                <label><input type="checkbox" name="local" id="urbano"> Urbano</label>
                <label><input type="checkbox" name="local" id="rural"> Rural</label>
                <label><input type="checkbox" name="local" id="aberto"> Aberto</label>
                <label><input type="checkbox" name="local" id="fechado"> Fechado</label>
                <button class="removebutton" onclick="clearSection('local')">Limpar</button>
            </div>
        </div>
        <div class="filterGroup">
            <h2>Permitido:</h2>
            <div class="filterOptions">
                <label><input type="checkbox" name="permitido" id="animais"> Animais</label>
                <label><input type="checkbox" name="permitido" id="dormir"> Dormir no local</label>
                <label><input type="checkbox" name="permitido" id="fumar"> Fumar</label>
                <label><input type="checkbox" name="permitido" id="crianças"> Crianças</label>
                <label><input type="checkbox" name="permitido" id="pescar"> Pescar</label>
                <button class="removebutton" onclick="clearSection('permitido')">Limpar</button>
            </div>
        </div>
        <div class="filterGroup">
            <h2>Tem:</h2>
            <div class="filterOptions">
                <label><input type="checkbox" name="tem" id="acessibilidade"> Acessibilidade</label>
                <label><input type="checkbox" name="tem" id="animatronicos"> Animatrônicos</label>
                <label><input type="checkbox" name="tem" id="aparelho-de-som"> Aparelho de som</label>
                <label><input type="checkbox" name="tem" id="aquecedor"> Aquecedor</label>
                <label><input type="checkbox" name="tem" id="ar-condicionado"> Ar condicionado</label>
                <label><input type="checkbox" name="tem" id="banheiro"> Banheiro</label>
                <label><input type="checkbox" name="tem" id="buffet"> Buffet</label>
                <label><input type="checkbox" name="tem" id="cama"> Cama</label>
                <label><input type="checkbox" name="tem" id="campo-de-futebol"> Campo de futebol</label>
                <label><input type="checkbox" name="tem" id="campo-de-golfe"> Campo de golfe</label>
                <label><input type="checkbox" name="tem" id="camera-de-seguranca"> Câmera de
                    segurança</label>
                <label><input type="checkbox" name="tem" id="casa-na-arvore"> Casa na árvore</label>
                <label><input type="checkbox" name="tem" id="churrasqueira"> Churrasqueira</label>
                <label><input type="checkbox" name="tem" id="elevador"> Elevador</label>
                <label><input type="checkbox" name="tem" id="espaco-infantil"> Espaço infantil</label>
                <label><input type="checkbox" name="tem" id="espaco-para-acampar"> Espaço para
                    acampar</label>
                <label><input type="checkbox" name="tem" id="estacionamento"> Estacionamento</label>
                <label><input type="checkbox" name="tem" id="fliperama"> Fliperama</label>
                <label><input type="checkbox" name="tem" id="freezer"> Freezer</label>
                <label><input type="checkbox" name="tem" id="heliporto"> Heliporto</label>
                <label><input type="checkbox" name="tem" id="itens-de-cozinha"> Itens de Cozinha</label>
                <label><input type="checkbox" name="tem" id="karaoke"> Karaokê</label>
                <label><input type="checkbox" name="tem" id="lago"> Lago</label>
                <label><input type="checkbox" name="tem" id="mesa-de-sinuca"> Mesa de sinuca</label>
                <label><input type="checkbox" name="tem" id="microfones"> Microfones</label>
                <label><input type="checkbox" name="tem" id="pista-de-ski"> Pista de Ski</label>
                <label><input type="checkbox" name="tem" id="piscina"> Piscina</label>
                <label><input type="checkbox" name="tem" id="quadra-de-basquete"> Quadra de
                    basquete</label>
                <label><input type="checkbox" name="tem" id="quadra-de-tenis"> Quadra de tênis</label>
                <label><input type="checkbox" name="tem" id="rio"> Rio</label>
                <label><input type="checkbox" name="tem" id="sauna"> Sauna</label>
                <label><input type="checkbox" name="tem" id="seguranca"> Segurança</label>
                <label><input type="checkbox" name="tem" id="tenis-de-mesa"> Tênis de mesa</label>
                <label><input type="checkbox" name="tem" id="wi-fi"> Wi-fi</label>
                <button class="removebutton" onclick="clearSection('tem')">Limpar</button>



            </div>
        </div>

        <button class="aplicar">Aplicar</button>

    </div>

    <script>
        async function fetchProperties() {
            const response = await fetch('http://localhost:3000/realty'); // Verifique se a URL está correta
            if (!response.ok) {
                throw new Error('Falha ao buscar propriedades');
            }
            const data = await response.json();
            console.log('Dados das propriedades:', data); // Log da resposta da API
            return data;
        }

        async function fetchUsers() {
            const response = await fetch('http://localhost:3000/users'); // Verifique se a URL está correta
            if (!response.ok) {
                throw new Error('Falha ao buscar usuários');
            }
            return await response.json();
        }

        async function displayProperties() {
    try {
        const properties = await fetchProperties();
        const users = await fetchUsers();
        const placesContainer = document.getElementById("placesContainer");

        properties.forEach(property => {
            // Encontra o usuário correspondente usando o ownerId
            const owner = users.find(user => user.id === String(property.userId));

            const placeContainer = document.createElement("div");
            placeContainer.className = "placeContainer";

            // Cria o link com um evento de clique para salvar os dados no localStorage
            const propertyLink = document.createElement("a");
            propertyLink.href = "../announcement-screen/index.html";
            propertyLink.target = "_blank";

            propertyLink.addEventListener("click", () => {
                // Salva os dados da propriedade no localStorage
                localStorage.setItem("selectedProperty", JSON.stringify(property));
            });

            // Monta o conteúdo HTML dentro do link
            propertyLink.innerHTML = `
                <img class="placeImage" src="${property.image_url || './img/eichenwaldeTest.png'}">
                <div class="otherAlign">
                    <div class="placeTop">
                        <label id="placeFont" class="placeName">${property.title}</label>
                        <label id="placeFont" class="placeOwner">Por: ${property ? property.userId.name : 'Desconhecido'}</label>
                        <div class="placePriceDiv">
                            <label id="placeFont" class="placePrice">R$ ${property.value}</label>
                            <label id="placeFont">por diária</label>
                        </div>
                    </div>
                    <div class="alignRating">
                        <img class="profilePicAd" src="${owner ? owner.profile_pic_url : './img/profilePicAd.png'}">
                        <div class="ratingSection">
                            <label class="placePrice">${property.rating}</label>
                            <img class="ratingStar" src="./img/ratingStar.png">
                        </div>
                    </div>
                </div>
            `;

            // Adiciona o link ao container da propriedade
            placeContainer.appendChild(propertyLink);
            placesContainer.appendChild(placeContainer);
        });
    } catch (error) {
        console.error('Erro ao exibir propriedades:', error);
    }
}

// Chama a função para exibir propriedades ao carregar a página
window.onload = displayProperties;











        async function filterProperties(category) {
            try {
                const properties = await fetchProperties();
                const users = await fetchUsers();
                const placesContainer = document.getElementById("placesContainer");

                // Limpar o container antes de adicionar as propriedades filtradas
                placesContainer.innerHTML = '';

                // Filtrar as propriedades pela categoria
                const filteredProperties = properties.filter(property => property.category === category);

                // Exibir as propriedades filtradas
                filteredProperties.forEach(property => {
                    // Encontrar o usuário correspondente usando o userId
                    const owner = users.find(user => user.id === String(property.userId));

                    const placeContainer = document.createElement("div");
                    placeContainer.className = "placeContainer";

                    placeContainer.innerHTML = `
                    <a href="../announcement-screen/index.html" target="_blank">
            <img class="placeImage" src="${property.image_url ? property.image_url : './img/eichenwaldeTest.png'}">
            <div class="otherAlign">
                <div class="placeTop">
                    <label id="placeFont" class="placeName">${property.title}</label>
                    <label id="placeFont" class="placeOwner">Por: ${property ? property.userId.name : 'Desconhecido'}</label>
                    <div class="placePriceDiv">
                        <label id="placeFont" class="placePrice">R$ ${property.value}</label>
                        <label id="placeFont">por diária</label>
                    </div>
                </div>
                <div class="alignRating">
                    <img class="profilePicAd" src="${owner ? owner.profile_pic_url : './img/profilePicAd.png'}">
                    <div class="ratingSection">
                        <label class="placePrice">${property.rating}</label>
                        <img class="ratingStar" src="./img/ratingStar.png">
                    </div>
                </div>
            </div>
            </a>
        `;

                    placesContainer.appendChild(placeContainer);
                });
            } catch (error) {
                console.error('Erro ao filtrar propriedades:', error);
            }
        }




        async function clearFilters() {
            try {
                const properties = await fetchProperties(); // Recarregar todas as propriedades
                const users = await fetchUsers(); // Carregar os usuários novamente
                const placesContainer = document.getElementById("placesContainer");
                placesContainer.innerHTML = ''; // Limpar as propriedades já exibidas

                properties.forEach(property => {
                    // Encontrar o usuário correspondente
                    const owner = users.find(user => user.id === String(property.userId));

                    const placeContainer = document.createElement("div");
                    placeContainer.className = "placeContainer";

                    placeContainer.innerHTML = `
                    <a href="../announcement-screen/index.html" target="_blank">
                <img class="placeImage" src="${property.image_url ? property.image_url : './img/eichenwaldeTest.png'}">
                <div class="otherAlign">
                    <div class="placeTop">
                        <label id="placeFont" class="placeName">${property.title}</label>
                        <label id="placeFont" class="placeOwner">Por: ${property ? property.userId.name : 'Desconhecido'}</label>
                        <div class="placePriceDiv">
                            <label id="placeFont" class="placePrice">R$ ${property.value}</label>
                            <label id="placeFont">por diária</label>
                        </div>
                    </div>
                    <div class="alignRating">
                        <img class="profilePicAd" src="${owner ? owner.profile_pic_url : './img/profilePicAd.png'}">
                        <div class="ratingSection">
                            <label class="placePrice">${property.rating}</label>
                            <img class="ratingStar" src="./img/ratingStar.png">
                        </div>
                    </div>
                </div>
            `;

                    placesContainer.appendChild(placeContainer);
                });
            } catch (error) {
                console.error('Erro ao limpar filtros:', error);
            }
        }
    </script>
    <script src="js/script.js"></script>

</body>

</html>