<!DOCTYPE html>
<html>

<head>
    <title>Locaai - O Seu Site de Eventos</title>
    <link rel="stylesheet" type="text/css" href="../top-bar/css/topBarStyle.css">
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link rel="icon" type="icon/png" href="img/icon.png">
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
    <script src="../top-bar/topBarFunctions.js" defer></script>
</head>

<body>
    <div class="searchBar">
        <img id="logo" class="logoTop" src="../top-bar/img/logoLado.png">
        <div class="searchBar2">
            <input type="text" placeholder="Vai pra onde?" class="searchInput">
            <input type="number" id="justNumberInput" placeholder="Quantos dias?" class="searchInput">
            <div class="searchInputWrapper">
                <input type="number" id="justNumberInput" placeholder="Com quem?" class="searchInputWithButton">
                <button type='submit' class="buttonSearch"></button>
                <button type='submit' class="buttonFilters" id="toggleButton"></button>
            </div>
        </div>
        <div>
            <button class="announcementButton">ANUNCIE!</button>
        </div>
        <a href="../profile-screen/index.html">
            <div class="picAndLabels">
                <div class="textLocatorInfo">
                    <label class="textName">Eduardo França</label>
                    <label class="locatorLevel">Locador Ouro</label>
                </div>
                <img class="profilePicLogo" src="../top-bar/img/profilePicTest.png">
            </div>
        </a>
    </div>
    <div id="filtersBar" class="filtersBar"></div>
    

    <div class="placesLine" id="placesContainer"></div>

<script>
    async function fetchProperties() {
    const response = await fetch('http://localhost:3000/realty'); // Verifique se a URL está correta
    if (!response.ok) {
        throw new Error('Falha ao buscar propriedades');
    }
    const data = await response.json();
    console.log('Dados das propriedades:', data); // Log da resposta da API
    return data;
}

    async function fetchUsers() {
        const response = await fetch('http://localhost:3000/users'); // Verifique se a URL está correta
        if (!response.ok) {
            throw new Error('Falha ao buscar usuários');
        }
        return await response.json();
    }

    async function displayProperties() {
        try {
            const properties = await fetchProperties();
            const users = await fetchUsers();
            const placesContainer = document.getElementById("placesContainer");

            

            properties.forEach(property => {
                // Encontre o usuário correspondente usando o ownerId
                const owner = users.find(user => user.id === String(property.userId)); // Converte user_id para string // Ajuste conforme a estrutura do seu objeto

                console.log('Propriedade:', property);
                console.log('Dono encontrado:', owner);

                const placeContainer = document.createElement("div");
                placeContainer.className = "placeContainer";

                placeContainer.innerHTML = `
                    <img class="placeImage" src="${property.image_url ? property.image_url : './img/eichenwaldeTest.png'}">
                    <div class="otherAlign">
                        <div class="placeTop">
                            <label id="placeFont" class="placeName">${property.title}</label>
                            <label id="placeFont" class="placeOwner">Por: ${property ? property.userId.name : 'Desconhecido'}</label>
                            <div class="placePriceDiv">
                                <label id="placeFont" class="placePrice">R$ ${property.value}</label>
                                <label id="placeFont">por diária</label>
                            </div>
                        </div>
                        <div class="alignRating">
                            <img class="profilePicAd" src="${owner ? owner.profile_pic_url : './img/profilePicAd.png'}">
                            <div class="ratingSection">
                                <label class="placePrice">${property.rating}</label>
                                <img class="ratingStar" src="./img/ratingStar.png">
                            </div>
                        </div>
                    </div>
                `;

                placesContainer.appendChild(placeContainer);
            });
        } catch (error) {
            console.error('Erro ao exibir propriedades:', error);
        }
    }

    // Call the function to display properties when the page loads
    window.onload = displayProperties;
</script>
    <script src="js/script.js"></script>

</body>

</html>